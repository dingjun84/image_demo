# 部署milvus 0.10.0版本
https://github.com/dingjun84/milvus-docs/blob/v0.10.0/site/zh-CN/quick_start/install_milvus/cpu_milvus_docker.md

```
docker pull milvusdb/milvus:0.10.0-cpu-d061620-5f3c00
```


## milvus 源码
https://github.com/dingjun84/milvus/tree/v0.10.0

### 配置文件
https://github.com/dingjun84/milvus/blob/v0.10.0/core/conf/demo/server_config.yaml

wget https://raw.githubusercontent.com/dingjun84/milvus/v0.10.0/core/conf/demo/server_config.yaml


部署详细过程见： ![cpu_milvus_docker.md](docs/cpu_milvus_docker.md)

## 容器配置说明
主机目录地址为：
```
/mnt/ps/milvus
```
server_config.yaml保存地址：
```
/mnt/ps/milvus/conf
```
配置文件需要调整以下内存等参数：
```
cache:
  cache_size: 1GB
  insert_buffer_size: 256MB
```

启动容器：
```
docker run -d --name milvus_cpu_0.10.0 \
-p 19530:19530 \
-p 19121:19121 \
-v /mnt/ps/milvus/db:/var/lib/milvus/db \
-v /mnt/ps/milvus/conf:/var/lib/milvus/conf \
-v /mnt/ps/milvus/logs:/var/lib/milvus/logs \
-v /mnt/ps/milvus/wal:/var/lib/milvus/wal \
milvusdb/milvus:0.10.0-cpu-d061620-5f3c00
```
如果启动出错可以查看日志：docker logs container_id
```bash
[root@VM-0-16-centos conf]# docker ps
CONTAINER ID   IMAGE                                       COMMAND                  CREATED         STATUS          PORTS                                                                                          NAMES
03dc5b59e515   milvusdb/milvus:0.10.0-cpu-d061620-5f3c00   "/var/lib/milvus/doc…"   3 minutes ago   Up 23 seconds   0.0.0.0:19121->19121/tcp, :::19121->19121/tcp, 0.0.0.0:19530->19530/tcp, :::19530->19530/tcp   milvus_cpu_0.10.0
```

```bash
export MILVUS_IP=$(ip a | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'| head -n 1)

echo $MILVUS_IP

docker run -d --name zilliz_search_images_demo \
-v /mnt/ps/pic1:/tmp/pic1 \
-v /mnt/ps/pic2:/tmp/pic2 \
-v /mnt/ps/images-data:/tmp/images-data \
-p 35000:5000 \
-e "DATA_PATH=/tmp/images-data" \
-e "MILVUS_HOST=${MILVUS_IP}" \
milvusbootcamp/pic-search-webserver:0.10.0
```

export WEBSERVER_IP=$MILVUS_IP
echo $WEBSERVER_IP

# 修改源代码
- 用当前git下的源码替换镜像中的webserver代码
- 上传模型文件，源码中有pic_search\webserver\data\models 到 /app/data/models
```bash
# 从容器内拷贝文件到linux主机上
# docker cp 容器id:容器内路径 目标主机路径
docker cp eaac94ef6926:/home/test.txt /root/test.txt
 
# 从宿主机拷贝文件到容器内 # docker cp 文件路径 容器id:容器内路径
docker cp test.txt eaac94ef6926:/home/test.txt
```
